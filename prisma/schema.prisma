generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Contact {
  id                    String   @id @default(cuid())
  contactType           String   @default("Parent") // Parent, Student, Partner, Other
  primaryFirstName      String
  primaryLastName       String
  studentName           String?
  studentGradYear       String?
  email                 String?
  phone                 String?
  preferredContactMethod String?  @default("Email") // Email, Text, Call
  city                  String?
  state                 String?  @default("TX")
  schoolName            String?
  notesStatic           String?

  // Acquisition / Segmentation
  leadSource            String?  @default("Other") // Referral, Workshop, School Partner, Instagram, Google, Past Client, Other
  referredBy            String?
  serviceInterest       String?  // Academic Planning, Essays, Apps, Test Planning, Scholarships, Comprehensive
  budgetFit             String?  @default("Unknown") // High, Medium, Low, Unknown
  priorityScore         String?  @default("Cold") // 1-5 or Cold, Warm, Hot

  // Pipeline
  leadStatus            String   @default("New Lead")
  statusReason          String?
  owner                 String   @default("Admin")
  dateAdded             DateTime @default(now())
  lastContactDate       DateTime?
  nextFollowUpDate      DateTime?
  nextStep              String?

  // Client / Onboarding
  packageInterestedIn   String?
  packagePurchased      String?
  startDate             DateTime?
  endDate               DateTime?
  clientStatus          String?  // Active, Paused, Completed
  paymentStatus         String?  @default("Not invoiced") // Not invoiced, Invoiced, Paid, Partial
  contractSent          Boolean  @default(false)
  contractSigned        Boolean  @default(false)

  updatedAt             DateTime @updatedAt

  interactions          Interaction[]
  auditLogs             AuditLog[]

  @@index([leadStatus])
  @@index([nextFollowUpDate])
  @@index([clientStatus])
}

model Interaction {
  id                String   @id @default(cuid())
  date              DateTime @default(now())
  contactId         String
  interactionType   String   // Call, Email, Text, Meeting, Workshop, DM
  summary           String
  outcome           String?
  nextFollowUpDate  DateTime?
  loggedBy          String   @default("Admin")

  contact           Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@index([contactId])
  @@index([date])
}

model AuditLog {
  id          String   @id @default(cuid())
  contactId   String
  field       String
  oldValue    String?
  newValue    String?
  changedBy   String   @default("Admin")
  changedAt   DateTime @default(now())

  contact     Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@index([contactId])
}

model SyncLog {
  id          String   @id @default(cuid())
  syncType    String   // full, contacts, interactions
  status      String   // success, error, in_progress
  message     String?
  rowsSynced  Int      @default(0)
  startedAt   DateTime @default(now())
  completedAt DateTime?
}
